@page
@model weekday.Pages.TeamLead.BoardModel
@{
    
}

<section >
    <div class="d-flex justify-content-between p-4">
        <h3 class="h3">Board</h3>
        <div class="d-flex justify-content-evenly" style="gap: 20px">
            <div class="btn btn-scondary p-0 m-0 ">
                <select asp-for="createTeam.ProjectId" id="projectNameSort" class="form-select py-2 pe-5 me-5 h6 font-semibold text-muted text-sm">
                    <option class=" h6 font-semibold text-muted text-sm" value="-1">All Projects</option>
                    @foreach (var project in Model.projectDetails)
                    {
                        <option class="h6 font-semibold text-muted text-sm" value="@project.ProjectId">
                            @project.ProjectName
                        </option>
                    }
                </select>
            </div>

            <div class="dropdown">    
                <button class="btn btn-sm btn-primary dropdown-toggle px-4 py-2" type="button" id="dropdownMenuButton" data-bs-toggle="dropdown" aria-expanded="false">
                    <i class="fa-solid fa-plus" style="margin-right: 10px;"></i>
                    Create
                </button>

                <div class="dropdown-menu" aria-labelledby="dropdownMenuButton">
                    <a type="button" href="#" data-bs-toggle="modal" data-bs-target="#TaskModal" class="dropdown-item text-sm py-1 mx-2" style="font-weight: 500">
                        <i class="fa-solid fa-code-pull-request mx-2"></i> Task
                    </a>
                    <div class="dropdown-divider"></div>
                    <a type="button" href="#" data-bs-toggle="modal" data-bs-target="#TeamModal" class="dropdown-item text-sm py-1 mx-2" style="font-weight: 500">
                        <i class="fa-solid fa-user-plus mx-2"></i> Team
                    </a>
                </div>
            </div>
        </div>
    </div>

    @* ---------------------------------------  board code ------------------------------------------------  *@

    <div class="row mb-3">
        <div class="col-12 col-lg-4 col-md-4">
            <div class="card" style="height: 88vh;">
                <h5 class="card-title h5 my-3 text-uppercase text-center text-primary">TO DO</h5>
                <div id="To-Do" class="card-body card-scroll d-flex flex-column pt-1" style="gap: 10px;">        

                   @*  <div class="col-auto">
                        <div class="avatar-group">
                            <a href="#" class="avatar avatar-xs rounded-circle text-white border border-1 border-solid border-card"><img alt="..." src="https://images.unsplash.com/photo-1522307837370-cc113a36b784?ixlib=rb-1.2.1&ixid=eyJhcHBfaWQiOjEyMDd9&auto=format&fit=facearea&facepad=3&w=256&h=256&q=80"> </a>
                            <a href="#" class="avatar avatar-xs rounded-circle text-white border border-1 border-solid border-card"><img alt="..." src="https://images.unsplash.com/photo-1522307837370-cc113a36b784?ixlib=rb-1.2.1&ixid=eyJhcHBfaWQiOjEyMDd9&auto=format&fit=facearea&facepad=3&w=256&h=256&q=80"> </a>
                            <a href="#" class="avatar avatar-xs rounded-circle text-white border border-1 border-solid border-card"><img alt="..." src="https://images.unsplash.com/photo-1522307837370-cc113a36b784?ixlib=rb-1.2.1&ixid=eyJhcHBfaWQiOjEyMDd9&auto=format&fit=facearea&facepad=3&w=256&h=256&q=80"></a>
                            <a href="#" class="avatar avatar-xs rounded-circle text-white border border-1 border-solid border-card"><img alt="..." src="https://images.unsplash.com/photo-1522307837370-cc113a36b784?ixlib=rb-1.2.1&ixid=eyJhcHBfaWQiOjEyMDd9&auto=format&fit=facearea&facepad=3&w=256&h=256&q=80"></a>
                            <a href="#" class="avatar avatar-xs rounded-circle text-white border border-1 border-solid border-card"><img alt="..." src="https://images.unsplash.com/photo-1522307837370-cc113a36b784?ixlib=rb-1.2.1&ixid=eyJhcHBfaWQiOjEyMDd9&auto=format&fit=facearea&facepad=3&w=256&h=256&q=80"></a>
                        </div>
                    </div> *@

                    @{
                        if (Model.projectTasks.Count != 0) {
                            foreach(var task in Model.projectTasks)
                            {
                                int taskId = task.taskDetails.TaskId * 5 + 102;

                                if(task.taskDetails.Status == "To-Do")
                                {
                                    <a id="navigateLink" asp-page="/TeamLead/Task" asp-route-taskId="@task.taskDetails.TaskId" ondblclick="handleDoubleClick()">
                                    <div class="card task-cards" data-id="@task.taskDetails.TaskId" style="box-shadow: rgba(50, 50, 105, 0.15) 0px 2px 5px 0px, rgba(0, 0, 0, 0.05) 0px 1px 1px 0px;">
                                        <div class="card-body">
                                            <div class="row">
                                                <div class="col">
                                                    <span class="h4 font-semibold text-muted text-sm d-block">@task.taskDetails.Summary</span>
                                                </div>
                                            </div>
                                           
                                            <div class="mt-2 mb-0 row">
                                                <div class="col-1">
                                                    <span>
                                                        @{
                                                            if(task.taskDetails.Title == "Bug")
                                                            {
                                                                <i class="fa-solid fa-lg fa-bug" style="color: #ff4000;"></i>
                                                            }
                                                            if (task.taskDetails.Title == "Feature")
                                                            {
                                                                <i class="fa-solid fa-lg fa-circle-stop" style="color: #63E6BE;"></i>
                                                            }
                                                            if (task.taskDetails.Title == "Improvement")
                                                            {
                                                                <i class="fa-solid fa-chart-line fa-lg" style="color: #74C0FC;"></i>
                                                            }
                                                        }
                                                    </span>
                                                </div>
                                                <div class="col-2">
                                                    <span class="font-semibold text-muted text-sm d-flex align-items-center" style="margin-top: 2px;"><i class="fa-solid fa-sm fa-hashtag me-1" style="color: #616161;"></i> @taskId </span>
                                                </div>
                                                <div class="col-4 d-flex justify-content-end ms-auto">
                                                    <span class="me-3">
                                                        @{
                                                            if (task.taskDetails.Priority == "High")
                                                            {
                                                                <i class="fa-solid fa-xl fa-angles-up fa-fade" style="color: #ff0000;"></i>
                                                            }
                                                            if (task.taskDetails.Priority == "Medium")
                                                            {
                                                                <i class="fa-solid fa-xl fa-grip-lines" style="color: #FFD43B;"></i>
                                                            }
                                                            if (task.taskDetails.Priority == "Low")
                                                            {
                                                                <i class="fa-solid fa-xl fa-angles-down" style="color: #63E6BE;"></i>
                                                            }
                                                        }
                                                    </span>
                                                    <div class="avatar rounded-circle" style="height: 28px; width: 28px;">
                                                        <img alt="..." src="~/Images/profile-photo.png">
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="row mt-1">
                                                <div class="col-6">
                                                    <i class="fa-solid fa-code fa-xs me-1"></i>
                                                    <span class="font-semibold text-muted text-sm"> @task.ProjectName </span>
                                                </div>
                                                <div class="col-6">
                                                    <i class="fa-solid fa-user-group fa-xs me-1"></i>
                                                    <span class="font-semibold text-muted text-sm"> @task.TeamName </span>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    </a>
                                }     
                            }
                        }
                    }
                </div>
            </div>   
        </div>

        <div class="col-12 col-lg-4 col-md-4 ">
                <div class="card" style="height: 88vh;">
                    <h5 class="card-title h5 my-3 text-uppercase text-center text-primary">In Progress</h5>
                    <div id="In-Progress"  class="card-body card-scroll d-flex flex-column pt-1" style="gap : 10px;">
                    @{
                        if (Model.projectTasks.Count != 0)
                         {
                         
                            foreach (var task in Model.projectTasks)
                            {
                                int taskId = task.taskDetails.TaskId * 5 + 102;

                                if (task.taskDetails.Status == "In-Progress")
                                {
                                     <a id="navigateLink" asp-page="/TeamLead/Task" asp-route-taskId="@task.taskDetails.TaskId" ondblclick="handleDoubleClick()">
                                    <div class="card" data-id="@task.taskDetails.TaskId" style="box-shadow: rgba(50, 50, 105, 0.15) 0px 2px 5px 0px, rgba(0, 0, 0, 0.05) 0px 1px 1px 0px;">
                                        <div class="card-body">
                                            <div class="row">
                                                <div class="col">
                                                    <span class="h4 font-semibold text-muted text-sm d-block">@task.taskDetails.Summary</span>
                                                </div>
                                            </div>

                                            <div class="mt-2 mb-0 row">
                                                <div class="col-1">
                                                    <span>
                                                        @{
                                                            if (task.taskDetails.Title == "Bug")
                                                            {
                                                                <i class="fa-solid fa-lg fa-bug" style="color: #ff4000;"></i>
                                                            }
                                                            if (task.taskDetails.Title == "Feature")
                                                            {
                                                                <i class="fa-solid fa-lg fa-circle-stop" style="color: #63E6BE;"></i>
                                                            }
                                                            if (task.taskDetails.Title == "Improvement")
                                                            {
                                                                <i class="fa-solid fa-chart-line fa-lg" style="color: #74C0FC;"></i>
                                                            }
                                                        }
                                                    </span>
                                                </div>
                                                <div class="col-2">
                                                    <span class="font-semibold text-muted text-sm d-flex align-items-center" style="margin-top: 2px;"><i class="fa-solid fa-sm fa-hashtag me-1" style="color: #616161;"></i> @taskId </span>
                                                </div>
                                                <div class="col-4 d-flex justify-content-end ms-auto">
                                                    <span class="me-3">
                                                        @{
                                                            if (task.taskDetails.Priority == "High")
                                                            {
                                                                <i class="fa-solid fa-xl fa-angles-up fa-fade" style="color: #ff0000;"></i>
                                                            }
                                                            if (task.taskDetails.Priority == "Medium")
                                                            {
                                                                <i class="fa-solid fa-xl fa-grip-lines" style="color: #FFD43B;"></i>
                                                            }
                                                            if (task.taskDetails.Priority == "Low")
                                                            {
                                                                <i class="fa-solid fa-xl fa-angles-down" style="color: #63E6BE;"></i>
                                                            }
                                                        }
                                                    </span>
                                                    <div class="avatar rounded-circle" style="height: 28px; width: 28px;">
                                                        <img alt="..." src="~/Images/profile-photo.png">
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="row mt-1">
                                                <div class="col-6">
                                                    <i class="fa-solid fa-code fa-xs me-1"></i>
                                                    <span class="font-semibold text-muted text-sm"> @task.ProjectName </span>
                                                </div>
                                                <div class="col-6">
                                                    <i class="fa-solid fa-user-group fa-xs me-1"></i>
                                                    <span class="font-semibold text-muted text-sm"> @task.TeamName </span>
                                                </div>
                                            </div>

                                        </div>
                                    </div>
                                    </a>
                                }
                            }
                        }
                    }
                    </div>
                </div>
        </div>

            <div  class="col-lg-4 col-md-4">
                <div class="card" style="height: 88vh;">
                    <h5 class=" card-title h5 my-3 text-uppercase text-center text-primary">Done</h5>
                    <div id="Done" class="card-body card-scroll d-flex flex-column pt-1" style="gap : 10px;">

                    @{
                        if (Model.projectTasks.Count != 0)
                        {
                            foreach (var task in Model.projectTasks)
                            {
                                int taskId = task.taskDetails.TaskId * 5 + 102;

                                if (task.taskDetails.Status == "Done")
                                {
                                     <a id="navigateLink" asp-page="/TeamLead/Task" asp-route-taskId="@task.taskDetails.TaskId" ondblclick="handleDoubleClick()">
                                    <div class="card" data-id="@task.taskDetails.TaskId" style="box-shadow: rgba(50, 50, 105, 0.15) 0px 2px 5px 0px, rgba(0, 0, 0, 0.05) 0px 1px 1px 0px;">
                                        <div class="card-body">
                                            <div class="row">
                                                <div class="col">
                                                        <span class="h4 font-semibold text-muted text-sm d-block text-decoration-line-through">@task.taskDetails.Summary</span>
                                                </div>
                                            </div>

                                            <div class="mt-2 mb-0 row">
                                                <div class="col-1">
                                                    <span>
                                                        @{
                                                            if (task.taskDetails.Title == "Bug")
                                                            {
                                                                <i class="fa-solid fa-lg fa-bug" style="color: #ff4000;"></i>
                                                            }
                                                            if (task.taskDetails.Title == "Feature")
                                                            {
                                                                <i class="fa-solid fa-lg fa-circle-stop" style="color: #63E6BE;"></i>
                                                            }
                                                            if (task.taskDetails.Title == "Improvement")
                                                            {
                                                                <i class="fa-solid fa-chart-line fa-lg" style="color: #74C0FC;"></i>
                                                            }
                                                        }
                                                    </span>
                                                </div>
                                                <div class="col-2">
                                                    <span class="font-semibold text-muted text-sm d-flex align-items-center" style="margin-top: 2px;"><i class="fa-solid fa-sm fa-hashtag me-1" style="color: #616161;"></i> @taskId </span>
                                                </div>
                                                <div class="col-6 d-flex justify-content-end ms-auto">
                                                    <span class="me-4">
                                                            <i class="fa-solid fa-circle-check fa-xl" style="color: #71fe7a;"></i>
                                                    </span>
                                                    <span class="me-3">
                                                        @{
                                                            if (task.taskDetails.Priority == "High")
                                                            {
                                                                <i class="fa-solid fa-xl fa-angles-up fa-fade" style="color: #ff0000;"></i>
                                                            }
                                                            if (task.taskDetails.Priority == "Medium")
                                                            {
                                                                <i class="fa-solid fa-xl fa-grip-lines" style="color: #FFD43B;"></i>
                                                            }
                                                            if (task.taskDetails.Priority == "Low")
                                                            {
                                                                <i class="fa-solid fa-xl fa-angles-down" style="color: #63E6BE;"></i>
                                                            }
                                                        }
                                                    </span>
                                                    <div class="avatar rounded-circle" style="height: 28px; width: 28px;">
                                                        <img alt="..." src="~/Images/profile-photo.png">
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="row mt-1">
                                                <div class="col-6">
                                                    <i class="fa-solid fa-code fa-xs me-1"></i>
                                                    <span class="font-semibold text-muted text-sm"> @task.ProjectName </span>
                                                </div>
                                                <div class="col-6">
                                                    <i class="fa-solid fa-user-group fa-xs me-1"></i>
                                                    <span class="font-semibold text-muted text-sm"> @task.TeamName </span>
                                                </div>
                                            </div>

                                        </div>
                                    </div>
                                    </a>
                                }
                            }
                        }
                    }

                    </div>
                </div>
            </div>
        </div>
    </section>


    @* ---------------------------- board code ends here -----------------------------------------  *@

    @* ------------------------------- Create Team Modal ---------------------------------------- *@

<div class="modal fade" id="TeamModal" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered modal-xl">
        <div class="modal-content bg-surface-secondary">
            <form method="post" id="projectForm">
                <div class="modal-header">
                    <h1 class="modal-title fs-5" id="exampleModalLabel">Create Team</h1>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <div style="height : 50vh;">

                        @Html.AntiForgeryToken()
                        <label asp-for="createTeam.ProjectId" class="form-label">Project</label>
                        <select asp-for="createTeam.ProjectId" id="projectName" class="form-select">
                            <option value="-1"> -- Select Project --</option>
                            @foreach (var project in Model.projectDetails)
                            {
                                <option value="@project.ProjectId">
                                     @project.ProjectName
                                </option>     
                            }
                        </select>
                        <span asp-validation-for="createTeam.ProjectId" class="text-danger"></span>

                        <label asp-for="createTeam.TeamId" class="form-label">Project</label>
                        <select asp-for="createTeam.TeamId" id="teamList" class="form-select">
                            <option value="-1"> -- Choose Team -- </option>

                        </select>
                        <span asp-validation-for="createTeam.TeamId" class="text-danger"></span>

                        <label asp-for="createTeam.MembersId" class="form-label">Team Members</label>
                        <div class="dropdown w-full">
                            <button id="dropdownButton" type="button" class="form-select" data-bs-toggle="dropdown">
                                -- Choose Team Members --
                            </button>
                            <div class="dropdown-menu w-full" id="membersDropdown">
                                @foreach (var employee in Model.employees)
                                {
                                    <div class="dropdown-item">
                                        <div class="avatar rounded-circle">
                                            <img alt="..." src="https://images.unsplash.com/photo-1522307837370-cc113a36b784?ixlib=rb-1.2.1&ixid=eyJhcHBfaWQiOjEyMDd9&auto=format&fit=facearea&facepad=3&w=256&h=256&q=80">
                                        </div>
                                        <input type="checkbox" class="member-checkbox" value="@employee.EmployeeId" data-name="@($"{employee.FirstName} {employee.LastName}")" />
                                        @($"{employee.FirstName} {employee.LastName}")
                                    </div>
                                }
                            </div>
                        </div>

                        <input type="hidden" id="membersId" name="MemberId"
                               data-val="true"
                               data-val-required="Please select at least one team member."
                               data-val-minlength="1" />


                          <span asp-validation-for="createTeam.MembersId" class="text-danger"></span>
                        @* <button class="btn btn-primary" type="submit">Submit</button> *@


                        <div id="selectedMembers" class="mt-3">
                            <h5>Selected Members:</h5>
                            <div id="selectedMembersList"></div>
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button id="close-btn" type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                    <button type="submit" class="btn btn-primary">Save changes</button>
                </div>
            </form>
        </div>
    </div>
</div>

@* ----------------------------------- create Task Modal ------------------------------------ *@

<div class="modal fade modal-dialog-scrollable" id="TaskModal" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered modal-xl">
        <div class="modal-content bg-surface-secondary">
            <form method="post" id="taskForm">
                <div class="modal-header">
                    <h1 class="modal-title fs-5" id="exampleModalLabel">Create Task</h1>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body" style="height:56vh;">
                    
                        @Html.AntiForgeryToken()
                        <div class="row">
                            <div class="col-6">
                                <label asp-for="createTask.ProjectId" class="form-label">Project</label>
                                <select asp-for="createTask.ProjectId" id="T_ProjectId" class="form-select">
                                    <option value="-1"></option>
                                    @foreach (var project in Model.projectDetails)
                                    {
                                        <option value="@project.ProjectId">@project.ProjectName</option>
                                    }
                                </select>
                                <span asp-validation-for="createTask.ProjectId" class="text-danger"></span>
                            </div>
                            <div class="col-6">
                                <label asp-for="createTask.TeamId" class="form-label">Team</label>
                                <select asp-for="createTask.TeamId" id="T_TeamList" class="form-select">
                                   
                                </select>
                                <span asp-validation-for="createTeam.TeamId" class="text-danger"></span>
                            </div>
                        </div>
                        <div class="row mt-3">
                            <div class="col-4">
                                <label asp-for="createTask.Assignee" class="form-label d-block">Assignee</label>
                                <div class="dropdown w-full profile-dropdown">
                                    <button class="form-select text-start" type="button" id="profileDropdown" data-bs-toggle="dropdown" aria-expanded="false">
                                        Select Member
                                    </button>
                                    <div class="dropdown-menu w-100">
                                        <div class="p-2">
                                            <input type="text" class="form-control" id="profileSearch">
                                        </div>
                                        <div id="profileList">

                                        <a class="dropdown-item profile-item h5" href="#" data-user-id="-1" data-user-name="No Data Found" data-user-img="https://pics.craiyon.com/2023-12-05/_Aqc-hELTrSTfFsgYDoHwA.webp">
                                                     Select Project and Team to Load Members 
                                            </a>
                                        
                                        </div>
                                    </div>
                                </div>
                                <input asp-for="createTask.Assignee" type="hidden" id="selectedUserId" value="-1">
                                <span class="text-danger" asp-validation-for="createTask.Assignee"></span>
                            </div>
                            <div class="col-4">
                                <label asp-for="createTask.TaskType" class="form-label">Task Type</label>
                                <select asp-for="createTask.TaskType" id="T_TaskType" class="form-select">
                                    <option value="-1"></option>
                                    <option value="Bug">Bug</option>
                                    <option value="Feature">Feature</option>
                                    <option value="Improvement">Improvement</option>
                                </select>
                                <span asp-validation-for="createTask.TaskType" class="text-danger"></span>
                            </div>
                            <div class="col-4">
                                <label asp-for="createTask.Priority" class="form-label">Priority</label>
                                <select asp-for="createTask.Priority" id="T_Priority" class="form-select">
                                    <option value="-1"></option>
                                    <option value="High">High</option>
                                    <option value="Medium">Medium</option>
                                    <option value="Low">Low</option>
                                </select>
                                <span asp-validation-for="createTask.Priority" class="text-danger"></span>
                            </div>
                        </div>
                        <div class="row mt-3">
                            <div class="col-8">
                                <label asp-for="createTask.Summary" class="form-label">Summary</label>
                                <input asp-for="createTask.Summary" id="T_Summary" class="form-control" placeholder="headline of the task"/>
                                <span asp-validation-for="createTask.Summary" class="text-danger"></span>
                            </div>
                            <div class="col-4">
                                <label asp-for="createTask.Status" class="form-label">Status</label>
                                <select asp-for="createTask.Status" id="T_Status" class="form-select">
                                    <option value="To-Do" selected>To-Do</option>
                                    <option value="In-Progress">In-Progress</option>
                                    <option value="Done">Done</option>
                                </select>
                                <span class="text-danger" asp-validation-for="createTask.Status"></span>
                            </div>
                        </div>
                        <div class="row mt-3">
                            <div class="col-12">
                                <label asp-for="createTask.Description" for="quillEditor" class="form-label">Description</label>
                                <div id="quillEditor" class="form-control" style="height: fit-content"></div>
                                <input asp-for="createTask.Description" type="hidden" name="description" id="descriptionInput">
                            </div>
                        </div>
                        <div class="row mt-3">
                            <div class="col-6">
                                <label class="form-label" asp-for="createTask.StartDate">Start Date</label>
                                <input type="date" class="form-control" id="StartDate"
                                       asp-for="createTask.StartDate"
                                       value="" />
                                <span id="startDateSpan" class="text-danger" asp-validation-for="createTask.StartDate"></span>
                            </div>
                            <div class="col-6">
                                <label class="form-label" asp-for="createTask.Deadline">Deadline Date</label>
                                <input type="date" class="form-control" id="Deadline"
                                       asp-for="createTask.Deadline"
                                       value="" />
                                <span id="deadlineDateSapn" class="text-danger" asp-validation-for="createTask.Deadline"></span>
                            </div>
                        </div>           
                    </div>  
                
                <div class="modal-footer">
                    <button id="task_close-btn" type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                    <button type="submit" class="btn btn-primary">Save Task</button>
                </div>
            </form>
        </div>
    </div>
</div>


@section Scripts {
    <partial name="_ValidationScriptsPartial" />
        <script>

        function handleDoubleClick() {
            // Simulate a click on the anchor tag
            document.getElementById('navigateLink').click();
        }

        const randomDigit = Math.floor(Math.random() * 10);

            $(document).ready(function () {

                $("#projectName").on('change', function () {
                    $.ajax({
                        type: 'GET',
                        url: '@Url.Page("/TeamLead/Board", "TeamList")',
                        data: { 'ProjectId': $(this).val() },
                        success: (response) => {
                            $("#teamList").empty().append(`<option value= -1 > -- Choose Team -- </option>`)
                            response.forEach((item) => {
                                $("#teamList").append(`<option value=${item.teamId}> ${item.name} </option>`)
                            })
                        },
                        error: (error) => {
                            console.log("Error occures while fetching the team list");
                        }
                    })
                });


                
                    $('#projectNameSort').on('change',function () {
                        var projectId = $(this).val();

                        $.ajax({
                            url: '@Url.Page("/TeamLead/Board","FilterTask")', // Replace with the correct Razor Page route
                            method: 'GET',
                            data: { projectId: projectId },
                            success: function (response) {
                                console.log(response.success);
                            },
                            error: function (error) {
                                console.error('Error fetching tasks:', error);
                            }
                        });
                    });
                


                $(document).on('change', '.member-checkbox', function () {
                    const memberId = $(this).val();
                    const memberName = $(this).data('name');
                    const selectedIds = [];

                    if ($(this).is(':checked')) {
                        $('#selectedMembersList').append(`
                               <div class="selected-member" id="selected-${memberId}">
                                    ${memberName} <span class="remove-member" data-id="${memberId}">&times;</span>
                               </div>
                         `);
                    } else {
                        $(`#selected-${memberId}`).remove();
                    }

                    $('.member-checkbox:checked').each(function () {
                        selectedIds.push($(this).val());
                    });
                    $('#membersId').val(selectedIds.join(','));
                });

                $(document).on('click', '.remove-member', function () {
                    const memberId = $(this).data('id');
                    $(`#selected-${memberId}`).remove();
                    $(`.member-checkbox[value="${memberId}"]`).prop('checked', false).trigger('change');
                });

                // submit the create project form
                $('#projectForm').submit(function (e) {
                    e.preventDefault();

                    const formData = {
                        TeamId: $('#teamList').val(),
                        ProjectId: $('#projectName').val(),
                        MembersId: $('#membersId').val().split(',').map(Number),
                    };

                    console.log(formData);

                    $.ajax({
                        url: '/TeamLead/Board?handler=CreateOrUpdate',
                        type: 'POST',
                        contentType: 'application/json',
                        data: JSON.stringify(formData),
                        headers: {
                            'RequestVerificationToken': $('input[name="__RequestVerificationToken"]').val()
                        },
                        success: function (response) {
                            if(response.success) {
                            $("#close-btn").trigger('click');

                            } else {
                            
                                alert("Team Already exist");
                            }
                        },
                        error: function (error) {
                            alert('Error saving project!');

                        },
                    });
                });


                /// drop down with images
                $('#profileSearch').on('keyup', function () {
                    var value = $(this).val().toLowerCase();
                    $("#profileList .dropdown-item").filter(function () {
                        $(this).toggle($(this).text().toLowerCase().indexOf(value) > -1)
                    });
                });

            
                $('#profileList').on('click', '.dropdown-item', function (e) {
                    e.preventDefault();

               
                    var userId = $(this).data('user-id');
                    var userName = $(this).data('user-name');
                    var userImg = $(this).data('user-img');

                    console.log(userId + " " + userName);
     
                    // $('#profileDropdown').html(`
                    //             <div class="d-flex align-items-center">
                    //                                 <img src="https:pics.craiyon.com/2023-12-05/_Aqc-hELTrSTfFsgYDoHwA.webp" data-user-id="${userId}" alt="Profile" class="rounded-circle me-2" style="width: 30px; height: 30px;">
                    //                 ${userName}
                    //             </div>

                    // `);

                        $('#profileDropdown').html(`
                            <div class="d-flex align-items-center">
                                <img src="${userImg}" alt="Profile" class="rounded-circle me-2" style="width: 30px; height: 30px;">
                                ${userName}
                            </div>
                        `);

                      // Update the hidden input value
                     $('#selectedUserId').val(userId);
                });


                $("#T_ProjectId").on('change', function () {
                    $.ajax({
                        type: 'GET',
                        url: '@Url.Page("/TeamLead/Board", "TeamList")',
                        data: { 'ProjectId': $(this).val() },
                        success: (response) => {
                            $("#T_TeamList").empty().append(`<option value= -1></option>`)
                            response.forEach((item) => {
                                $("#T_TeamList").append(`<option value=${item.teamId}> ${item.name} </option>`)
                            })
                        },
                        error: (error) => {
                            console.log("Error occures while fetching the team list");
                        }
                    })
                })


                $("#T_TeamList").on('change', function() {
                    $('#profileDropdown').html(`<div>Choose Assignee</div>`);
                    $.ajax({
                        type: 'GET',
                        url: '@Url.Page("/TeamLead/Board","ProjectTeamMembers")',
                        data: {
                            ProjectId: $("#T_ProjectId").val(),
                            TeamId: $("#T_TeamList").val()
                        },
                        success: function (response) {
                            
                            console.log(response.teamMembers.length);
                            if (response.teamMembers.length == 0) {
                            
                            $("#profileList").empty();
                                $("#profileList").append(`<a class="dropdown-item profile-item" href="#" data-user-id="-1" data-user-name="No Data Found" data-user-img="" >
                                        No Data Found
                                     </a > `)
                            }
                            else {
                            $("#profileList").empty();
                                response.teamMembers.forEach((item) => {
                                    const userName = item.firstName + " " + item.lastName;
                                    
                                    $("#profileList").append(`<a class="dropdown-item profile-item" href="#" data-user-id="${item.employeeId}" data-user-name="${userName}" data-user-img="https://pics.craiyon.com/2023-12-05/_Aqc-hELTrSTfFsgYDoHwA.webp">
                                            <img src="https://pics.craiyon.com/2023-12-05/_Aqc-hELTrSTfFsgYDoHwA.webp" alt="Profile">
                                                         ${userName}
                                          </a>`)
                                });
                            }       
                    
                        },
                        error: (error) => {
                            console.log("Error occures while fetching the team list");
                        }
                    })
                })

                
                 
                    // Validate Start Date
                    $('#StartDate').on('change', function () {
                        const startDate = new Date($(this).val());
                        const today = new Date();

                        if (startDate < today.setHours(0, 0, 0, 0)) {
                            $("#startDateSpan").text("Start Date must be today or later"); 
                            $(this).val(""); // Reset invalid date
                        }
                    });

                    // Validate Deadline
                    $('#Deadline').on('change', function () {
                        const startDate = new Date($('#StartDate').val());
                        const deadline = new Date($(this).val());
                        const today = new Date();

                        if (deadline < today.setHours(0, 0, 0, 0)) {
                            $("#deadlineDateSpan").text("Deadline must be today or later.");
                            $(this).val(""); // Reset invalid date
                        } else if (startDate && deadline < startDate) {
                            $("#deadlineDateSpan").text("Deadline must be after or equal to the Start Date.");
                            $(this).val(""); // Reset invalid date
                        }
                    });
                
    



                $("#taskForm").submit(function (e) {
                    e.preventDefault()

                    const taskData = {
                        ProjectId: parseInt($('#T_ProjectId').val(), 10),
                        TeamId : parseInt($("#T_TeamList").val(), 10),
                        TaskType : $("#T_TaskType").val(),
                        Assignee: parseInt($('#selectedUserId').val(), 10),
                        Priority : $('#T_Priority').val(),
                        Summary : $('#T_Summary').val(),
                        Status : $('#T_Status').val(),
                        Description : descriptionInput.value,
                        StartDate : $('#StartDate').val(),
                        Deadline : $('#Deadline').val()
                    }

                   

                    $.ajax({
                        url: '@Url.Page("/TeamLead/Board", "CreateOrUpdateTask")',
                        type: 'POST',
                        contentType: 'application/json',
                        data: JSON.stringify(taskData),
                        headers: {
                            'RequestVerificationToken': $('input[name="__RequestVerificationToken"]').val()
                        },
                        success: function (response) {
                            if (response.success) {
                                $("#task_close-btn").trigger('click');

                            // Clear the form fields
                            $('#projectForm')[0].reset();

                            // Reset dropdown button to default
                            $('#profileDropdown').html('Select Member');
                            $('#selectedUserId').val('');

                            location.reload();

                            }
                        },
                        error: function (error) {
                            alert('Error saving project!');

                        },
                    })
                });





                new Sortable(document.getElementById('To-Do'), {
                    group: 'shared', // Allow cards to be moved between lists
                    animation: 150,
                    onEnd: function (evt) {
                        // After drag and drop, update task order
                        updateTaskOrder(evt.from.id, evt.to.id, evt.oldIndex, evt.newIndex);
                    }
                });

                new Sortable(document.getElementById('In-Progress'), {
                    group: 'shared',
                    animation: 150,
                    onEnd: function (evt) {
                        updateTaskOrder(evt.from.id, evt.to.id, evt.oldIndex, evt.newIndex);
                    }
                });

                new Sortable(document.getElementById('Done'), {
                    group: 'shared',
                    animation: 150,
                    onEnd: function (evt) {
                        updateTaskOrder(evt.from.id, evt.to.id, evt.oldIndex, evt.newIndex);
                    }
                });

                function updateTaskOrder(fromColumn, toColumn, oldIndex, newIndex) {
                    var taskIds = [];

                    console.log(fromColumn + " " + toColumn + " " + oldIndex + " " + newIndex);

                    // Collect task IDs from the updated column
                    $("#" + toColumn + " .card").each(function () {
                        taskIds.push($(this).data('id'));
                    });

                    // Send updated order of task IDs to the server
                    $.ajax({
                        url: '@Url.Page("/TeamLead/Board", "UpdateTaskOrder")',  //'/TeamLead/Board?UpdateTaskOrder', // Update with the correct endpoint
                        type: 'POST',
                        headers: {
                            'RequestVerificationToken': $('input[name="__RequestVerificationToken"]').val()
                        },
                        data: {
                            fromColumn: fromColumn,
                            toColumn: toColumn,
                            taskIds: taskIds // Send the new order of tasks
                        },
                        success: function (response) {
                            console.log('Order updated successfully');
                        },
                        error: function () {
                            console.log('Error updating order');
                        }
                    });
                }

            var quillOptions = {
                theme: 'snow', // or 'bubble'
                modules: {
                    toolbar: [
                        ['bold', 'italic', 'underline'],        // toggled buttons
                        ['blockquote', 'code-block'],
                        [{ 'header': 1 }, { 'header': 2 }],     // custom button values
                        [{ 'list': 'ordered' }, { 'list': 'bullet' }],
                        [{ 'script': 'sub' }, { 'script': 'super' }],    // superscript/subscript
                        [{ 'indent': '-1' }, { 'indent': '+1' }],        // outdent/indent
                        [{ 'direction': 'rtl' }],                       // text direction
                        [{ 'color': [] }, { 'background': [] }],        // dropdown with defaults
                        [{ 'font': [] }],
                        [{ 'align': [] }],
                        ['clean']                               // remove formatting
                    ]
                }
            };

            // Initialize Quill
            var quill = new Quill('#quillEditor', quillOptions);

            // Update hidden input with Quill content
            quill.on('text-change', function () {
                var descriptionInput = document.getElementById('descriptionInput');
                descriptionInput.value = quill.root.innerHTML;
            });
        });


    </script>
}

